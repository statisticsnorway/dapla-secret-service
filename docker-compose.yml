version: '3.7'

services:

  postgres:
    image: postgres:12-alpine
    ports:
      - 15432:5432
    volumes:
    - ./localenv/init-database.sql:/docker-entrypoint-initdb.d/init.sql

  secret-service:
    build: .
    image: dapla-secret-service:dev
    environment:
      PGPOOL_CONNECT_dash_OPTIONS_HOST: postgres
      PGPOOL_CONNECT_dash_OPTIONS_PORT: 5432
      FLYWAY_URL: jdbc:postgresql://postgres:5432/secret_service
    ports:
      - 10150:10150
      - 10158:10158
    depends_on:
      - postgres
